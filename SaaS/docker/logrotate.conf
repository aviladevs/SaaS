# Ávila DevOps SaaS - Logrotate Configuration
# Configuração para rotação automática de logs

# Logs do Nginx
/var/log/nginx/*.log {
    daily
    missingok
    rotate 52
    compress
    delaycompress
    notifempty
    create 644 nginx nginx
    postrotate
        [ -f /var/run/nginx.pid ] && kill -USR1 `cat /var/run/nginx.pid`
    endscript
}

# Logs da aplicação Django
/app/logs/*.log {
    daily
    missingok
    rotate 30
    compress
    delaycompress
    notifempty
    create 644 django django
    copytruncate
}

# Logs do Gunicorn
/app/logs/gunicorn*.log {
    daily
    missingok
    rotate 30
    compress
    delaycompress
    notifempty
    create 644 django django
    copytruncate
}

# Logs de acesso (separados para análise)
/var/log/nginx/access.log {
    daily
    missingok
    rotate 90
    compress
    delaycompress
    notifempty
    create 644 nginx nginx
    postrotate
        [ -f /var/run/nginx.pid ] && kill -USR1 `cat /var/run/nginx.pid`
    endscript
}

# Logs de erro (manter por mais tempo para debugging)
/var/log/nginx/error.log {
    weekly
    missingok
    rotate 26
    compress
    delaycompress
    notifempty
    create 644 nginx nginx
    postrotate
        [ -f /var/run/nginx.pid ] && kill -USR1 `cat /var/run/nginx.pid`
    endscript
}

# Logs de health checks (pequenos, manter pouco tempo)
/var/log/nginx/*health*.log {
    daily
    missingok
    rotate 7
    compress
    delaycompress
    notifempty
    create 644 nginx nginx
}
